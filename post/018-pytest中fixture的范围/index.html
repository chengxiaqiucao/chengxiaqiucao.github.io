<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Pytest中不同fixture的作用范围示例"><title>Pytest中fixture的范围</title><link rel=canonical href=https://chengxiaqiucao.github.io/post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Pytest中fixture的范围"><meta property='og:description' content="Pytest中不同fixture的作用范围示例"><meta property='og:url' content='https://chengxiaqiucao.github.io/post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/'><meta property='og:site_name' content='秋 草 观 “测” 台'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='pytest'><meta property='article:tag' content='自动化测试'><meta property='article:published_time' content='2024-08-28T20:33:52+08:00'><meta property='article:modified_time' content='2024-08-28T20:33:52+08:00'><meta name=twitter:title content="Pytest中fixture的范围"><meta name=twitter:description content="Pytest中不同fixture的作用范围示例"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/automnGrass_hu_5e44a092fd905642.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>秋 草 观 “测” 台</a></h1><h2 class=site-description>Testing is not just checking...</h2></div></header><ol class=menu-social><li><a href=https://github.com/chengxiaqiucao target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://space.bilibili.com/472272606 target=_blank title=Bilibili rel=me><!doctype html><svg t="1750732982440" class="icon" viewBox="0 0 1024 1024" p-id="4593" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M306.005333 117.632 444.330667 256h135.296l138.368-138.325333A42.666667 42.666667.0 01778.368 178.048L700.330667 256H789.333333A149.333333 149.333333.0 01938.666667 405.333333v341.333334A149.333333 149.333333.0 01789.333333 896H234.666667A149.333333 149.333333.0 0185.333333 746.666667V405.333333A149.333333 149.333333.0 01234.666667 256h88.96L245.632 177.962667a42.666667 42.666667.0 0160.373333-60.373334zm483.328 223.701333H234.666667a64 64 0 00-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0057.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0063.701334-57.856L853.333333 746.666667V405.333333a64 64 0 00-64-64zm-448 128A42.666667 42.666667.0 01384 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666666-42.666667zm341.333334.0A42.666667 42.666667.0 01725.333333 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666667-42.666667z" p-id="4594" fill="#8a8a8a"/></svg></a></li><li><a href=https://www.zhihu.com/people/qiucao target=_blank title=zhihu rel=me><!doctype html><svg t="1750733049138" class="icon" viewBox="0 0 1024 1024" p-id="5820" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M570.581333 806.272h61.952L652.928 876.117333 764.074667 806.272h130.986666V230.186667h-324.48V806.272zM636.501333 292.693333h192.64V743.68h-73.898666l-73.813334 46.378667L668.032 743.808l-31.530667-.128V292.736zM515.754667 493.738667H377.429333a2999.466667 2999.466667.0 005.802667-194.56h135.338667S523.776 239.445334 495.872 240.128H261.76c9.216-34.730667 20.821333-70.613333 34.688-107.690667.0.0-63.701333.0-85.333333 57.130667C202.112 213.12 176.128 303.786667 129.877333 396.416c15.573333-1.706667 67.114667-3.114667 97.450667-58.794667 5.589333-15.616 6.656-17.621333 13.568-38.485333h76.373333c0 27.776-3.157333 177.109333-4.437333 194.474667h-138.24c-31.104.0-41.173333 62.549333-41.173333 62.549333h173.482666C295.253333 688.256 232.789333 799.573333 119.466667 887.466667c54.186667 15.488 108.202667-2.432 134.912-26.197334.0.0 60.8-55.338667 94.122666-183.381333L491.264 849.834667s20.906667-71.168-3.285333-105.856c-20.053333-23.637333-74.24-87.552-97.322667-110.72l-38.698667 30.72c11.52-36.992 18.474667-72.96 20.821334-107.690667h163.072s-.213333-62.549333-20.053334-62.549333z" p-id="5821" fill="#8a8a8a"/></svg></a></li><li><a href=mailto:%20danmyw@qq.com target=_blank title=e-mail rel=me><!doctype html><svg t="1750733089669" class="icon" viewBox="0 0 1451 1024" p-id="6983" xmlns:xlink="http://www.w3.org/1999/xlink" width="283.3984375" height="200"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z" fill="#8a8a8a" p-id="6984"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>检索</span></a></li><li><a href=/page/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li><a href=/page/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/page/releases/><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg>
<span>热门开源</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://chengxiaqiucao.github.io/en/>English</option><option value=https://chengxiaqiucao.github.io/ selected>中文</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#fixture的scope定义>fixture的scope定义</a><ol><li><a href=#function>function</a></li><li><a href=#class>class</a></li><li><a href=#module>module</a></li><li><a href=#package>package</a></li><li><a href=#session>session</a></li></ol></li><li><a href=#复杂fixture的scope灵活定义>复杂fixture的scope灵活定义</a></li><li><a href=#不同scope的执行顺序>不同scope的执行顺序</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/ style=background-color:#c6fad2;color:#000>测试工具</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/>Pytest中fixture的范围</a></h2><h3 class=article-subtitle>Pytest中不同fixture的作用范围示例</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 28, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><p>pytest作为Python技术栈下最主流的测试框架，功能极为强大和灵活。其中Fixture夹具是它的核心。而且pytest中对Fixture的作用范围也做了不同区分，能为我们利用fixture带来很好地灵活性。</p><p>下面我们就来了解下这里不同scope的作用</p><h2 id=fixture的scope定义>fixture的scope定义</h2><p>首先根据官网的说明，Pytest中fixture的作用范围支持5种设定，分别是<code>function</code>(默认值), <code>classs</code>, <code>module</code>, <code>package</code>, <code>session</code></p><div class=table-wrapper><table><thead><tr><th style=text-align:center><strong>作用范围</strong></th><th style=text-align:left><strong>说明</strong></th></tr></thead><tbody><tr><td style=text-align:center><strong>function</strong></td><td style=text-align:left>默认值，对每个测试方法（函数）生效，生命周期在测试方法级别</td></tr><tr><td style=text-align:center><strong>class</strong></td><td style=text-align:left>对测试类生效，生命周期在测试类级别</td></tr><tr><td style=text-align:center><strong>module</strong></td><td style=text-align:left>对测试模块生效，生命周期在模块（文件）级别</td></tr><tr><td style=text-align:center><strong>package</strong></td><td style=text-align:left>对测试包生效，生命周期在测试包（目录）级别</td></tr><tr><td style=text-align:center><strong>session</strong></td><td style=text-align:left>对测试会话生效，生命周期在会话（一次pytest运行）级别</td></tr></tbody></table></div><p>下面结合代码来说明，假设目前有这样的代码结构</p><p><img src=/post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/Pasted-20240901.png width=421 height=401 srcset="/post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/Pasted-20240901_hu_8a3c9ede1d3d44ec.png 480w, /post/018-pytest%E4%B8%ADfixture%E7%9A%84%E8%8C%83%E5%9B%B4/Pasted-20240901_hu_ac4e7b7b7a6300b8.png 1024w" loading=lazy class=gallery-image data-flex-grow=104 data-flex-basis=251px></p><p><code>run_params</code>是被测方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>deal_params</span><span class=p>(</span><span class=n>p</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;input :</span><span class=si>{</span><span class=n>p</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>int</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>p</span><span class=o>*</span><span class=mi>10</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=ow>is</span> <span class=nb>str</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>p</span><span class=o>*</span><span class=mi>3</span>  
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nb>type</span><span class=p>(</span><span class=n>p</span><span class=p>)</span> <span class=ow>in</span> <span class=p>(</span><span class=nb>tuple</span><span class=p>,</span> <span class=nb>list</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;_&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>TypeError</span>
</span></span></code></pre></td></tr></table></div></div><p><code>test_ch_param</code>, <code>test_fixture_scope</code>中分别定义了参数化和在测试类中的不同测试方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@pytest.mark.parametrize</span><span class=p>(</span><span class=s2>&#34;param&#34;</span><span class=p>,[</span><span class=mi>10</span><span class=p>,</span> <span class=s2>&#34;城下秋草&#34;</span><span class=p>,</span> <span class=s2>&#34;软件测试&#34;</span><span class=p>,</span> <span class=p>(</span><span class=s2>&#34;示例&#34;</span><span class=p>,</span> <span class=s2>&#34;代码&#34;</span><span class=p>)])</span>  
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_params_mark</span><span class=p>(</span><span class=n>param</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>deal_params</span><span class=p>(</span><span class=n>param</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pytest</span>  
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestFixtureScope1</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_int</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>deal_params</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>20</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_str</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>deal_params</span><span class=p>(</span><span class=s2>&#34;秋草&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=s2>&#34;秋草秋草秋草&#34;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TestFixtureScope2</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_list</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>deal_params</span><span class=p>([</span><span class=s2>&#34;城下&#34;</span><span class=p>,</span><span class=s2>&#34;秋草&#34;</span><span class=p>])</span> <span class=o>==</span> <span class=s2>&#34;城下_秋草&#34;</span>  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>test_dict</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>pytest</span><span class=o>.</span><span class=n>raises</span><span class=p>(</span><span class=ne>TypeError</span><span class=p>):</span>  
</span></span><span class=line><span class=cl>            <span class=n>deal_params</span><span class=p>({</span><span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;秋草&#34;</span><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>在公共方法文件<code>conftest.py</code>中定义fixture: <code>prepare</code>， 设置了<code>autouse=True</code>，即会根据fixture的设置范围自动应用</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest.fixture</span><span class=p>(</span><span class=n>autouse</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>scope</span><span class=o>=</span><span class=s1>&#39;function&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>prepare</span><span class=p>():</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----some setup actions.....&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>yield</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-----some teardown actions!!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这里我们分别调整<code>prepare</code>的scope为不同取值，然后得到对应的输出</p><h3 id=function>function</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str -----some setup actions.....      
</span></span></span><span class=line><span class=cl><span class=go>input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list -----some setup actions.....     
</span></span></span><span class=line><span class=cl><span class=go>input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict -----some setup actions.....     
</span></span></span><span class=line><span class=cl><span class=go>input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p>fixture运行了8次</p><h3 id=class>class</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list -----some setup actions.....     
</span></span></span><span class=line><span class=cl><span class=go>input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p><code>test_ch_param</code>中的测试方法，因为直接定义在文件中，也属于类级别，所以每次赋值参数，fixture也被调用。 而 <code>test_fixture_scope</code>中明确定义了两个测试类，所以运行了2次</p><h3 id=module>module</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p>修改为module范围后，可以看到，每个模块文件调用了一次fixture</p><h3 id=package>package</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p>修改为package， 这是因为两个测试文件位于同一个package内， 所以运行了一次</p><h3 id=session>session</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p>最后，当设置为session时，也就是运行pytest的一次执行会话，才会触发一次fixture调用</p><p>所以可以看到，我们通过fixture的不同scope定义，可以根据需要，来确定我们编写的fixture夹具的作用范围。有很好的灵活性</p><h2 id=复杂fixture的scope灵活定义>复杂fixture的scope灵活定义</h2><p>有时在实际使用的时候，特别是我们的一些fixture初始化工作比较复杂但同时在不同作用范围下都可能会用到，这时如果仅仅因为针对不同的作用范围，就要编写多个不同的fixture，代码就显得比较冗余。这时可以怎么处理呢？ 其实可以利用上下文contextmanager来灵活实现</p><p>比如我们再编写一个fixture的基本代码上下文:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@contextmanager</span>  
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fixture_base</span><span class=p>():</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;~~~~~base fixture setup actions.....&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl>    <span class=k>yield</span>  
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;~~~~~base fixture teardown actions!!&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>然后针对不同的fixture，我们就可以根据不同的scope来定义不同的fixture并调用这里的context实现。 比如我们再定义一个scope为package的fixture</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@pytest.fixture</span><span class=p>(</span><span class=n>autouse</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>scope</span><span class=o>=</span><span class=s1>&#39;package&#39;</span><span class=p>)</span>  
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fixture_module</span><span class=p>():</span>  
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;  
</span></span></span><span class=line><span class=cl><span class=s2>    对于复杂的fixture但希望灵活处理scope，可以将公共代码放到一个contextmanager中，  
</span></span></span><span class=line><span class=cl><span class=s2>    再针对不同scope定义相关对应fixture  
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>    <span class=k>with</span> <span class=n>fixture_base</span><span class=p>()</span> <span class=k>as</span> <span class=n>result</span><span class=p>:</span>  
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>result</span>
</span></span></code></pre></td></tr></table></div></div><p>👍👍这个方法来自pytest的社区总结，<a class=link href=https://github.com/pytest-dev/pytest/issues/3425 target=_blank rel=noopener>原始问题链接</a></p><h2 id=不同scope的执行顺序>不同scope的执行顺序</h2><p>上面例子中我们其实看到package和session的执行效果，因为测试方法都在同一个package中，所以效果上没什么差异。但其实不同scope也是有执行顺序的</p><p>顺序总结如下：</p><p><code>session</code> > <code>package</code> > <code>module</code> > <code>class</code> > <code>function</code></p><p>这里增加到两个fixture以后，执行的结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>(.venv) C:\Chengxiaqiucao
</span></span></span><span class=line><span class=cl><span class=go>pytest
</span></span></span><span class=line><span class=cl><span class=go>======================================== test session starts =========================================
</span></span></span><span class=line><span class=cl><span class=go>collected 8 items                                                                                     
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[10] -----some setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>~~~~~base fixture setup actions.....
</span></span></span><span class=line><span class=cl><span class=go>input :10
</span></span></span><span class=line><span class=cl><span class=go>100
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[城下秋草] input :城下秋草
</span></span></span><span class=line><span class=cl><span class=go>城下秋草城下秋草城下秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[软件测试] input :软件测试
</span></span></span><span class=line><span class=cl><span class=go>软件测试软件测试软件测试
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_ch_parm.py::test_params_mark[param3] input :(&#39;示例&#39;, &#39;代码&#39;)
</span></span></span><span class=line><span class=cl><span class=go>示例_代码
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_int input :2
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope1::test_str input :秋草
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_list input :[&#39;城下&#39;, &#39;秋草&#39;]
</span></span></span><span class=line><span class=cl><span class=go>PASSED
</span></span></span><span class=line><span class=cl><span class=go>BlogDemo/testDemo/test_fixture_scope.py::TestFixtureScope2::test_dict input :{&#39;name&#39;: &#39;秋草&#39;}
</span></span></span><span class=line><span class=cl><span class=go>PASSED~~~~~base fixture teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go>-----some teardown actions!!
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>========================================= 8 passed in 0.27s ========================================== 
</span></span></span></code></pre></td></tr></table></div></div><p>可以看到 <code>session</code> 比 <code>package</code> 更早执行，同时更晚被销毁。</p><p>那么以上就是关于pytest scope作用范围的总结</p><hr><p>推广下我的测试课程，感兴趣的小伙伴可以通过以下链接了解下哦</p><p>❤️❤️❤️❤️ <a class=link href=https://coding.imooc.com/class/chapter/885.html#Anchor target=_blank rel=noopener>城下秋草的测试职业进阶提升课</a> ❤️❤️❤️❤️</p></section><footer class=article-footer><section class=article-tags><a href=/tags/pytest/>Pytest</a>
<a href=/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/>自动化测试</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/017-pytest%E4%B8%AD%E8%87%AA%E5%8A%A8%E6%8C%87%E5%AE%9A%E5%8F%AF%E5%BC%95%E7%94%A8fixture/><div class=article-image><img src=/post/017-pytest%E4%B8%AD%E8%87%AA%E5%8A%A8%E6%8C%87%E5%AE%9A%E5%8F%AF%E5%BC%95%E7%94%A8fixture/pytest.739cb187fe6d5cc5a43c7d2c8387c849_hu_f020361f601fb56a.png width=250 height=150 loading=lazy alt="Featured image of post Pytest中自动指定可引用fixture" data-hash="md5-c5yxh/5tXMWkPH0sg4fISQ=="></div><div class=article-details><h2 class=article-title>Pytest中自动指定可引用fixture</h2></div></a></article><article class=has-image><a href=/post/016-pytest%E5%8F%82%E6%95%B0%E5%8C%96%E6%97%B6%E7%9A%84%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/><div class=article-image><img src=/post/016-pytest%E5%8F%82%E6%95%B0%E5%8C%96%E6%97%B6%E7%9A%84%E4%B8%AD%E6%96%87%E4%B9%B1%E7%A0%81%E9%97%AE%E9%A2%98/Pasted-20240824.8ad2b7dc12f6690b38b6e4de63399c9e_hu_f73fd713567bd143.png width=250 height=150 loading=lazy alt="Featured image of post Pytest使用Fixture进行参数化及中文乱码问题" data-hash="md5-itK33BL2aQs4tuTeYzmcng=="></div><div class=article-details><h2 class=article-title>Pytest使用Fixture进行参数化及中文乱码问题</h2></div></a></article><article class=has-image><a href=/post/081-midscene%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/><div class=article-image><img src=/post/081-midscene%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/snap_20250621-5.62e64a7cc6316cdf058647603a537783_hu_5f4e5d6c5a1c2f4d.png width=250 height=150 loading=lazy alt="Featured image of post AI自动化工具Midscene.js源码解析" data-hash="md5-YuZKfMYxbN8FhkdgOlN3gw=="></div><div class=article-details><h2 class=article-title>AI自动化工具Midscene.js源码解析</h2></div></a></article><article class=has-image><a href=/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/><div class=article-image><img src=/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo.82386a35c48e32d43f12199ac6a46a38_hu_d1321ae71a371e02.png width=250 height=150 loading=lazy alt="Featured image of post Playwright新版本筛选功能" data-hash="md5-gjhqNcSOMtQ/EhmaxqRqOA=="></div><div class=article-details><h2 class=article-title>Playwright新版本筛选功能</h2></div></a></article><article class=has-image><a href=/post/057-pytest_mock%E8%AF%A6%E8%A7%A3/><div class=article-image><img src=/post/057-pytest_mock%E8%AF%A6%E8%A7%A3/pytest-mock.19d1cb0d40a92f91ec29c98b79389968_hu_37d894218d376fb9.png width=250 height=150 loading=lazy alt="Featured image of post Pytest_mock详解" data-hash="md5-GdHLDUCpL5HsKcmLeTiZaA=="></div><div class=article-details><h2 class=article-title>Pytest_mock详解</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 |by 城下秋草（公众号： 秋草说测试）</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>
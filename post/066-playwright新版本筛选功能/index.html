<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Playwright 最新的1.5.1版本中增加的一个实用更新介绍"><title>Playwright新版本筛选功能</title><link rel=canonical href=https://chengxiaqiucao.github.io/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="Playwright新版本筛选功能"><meta property='og:description' content="Playwright 最新的1.5.1版本中增加的一个实用更新介绍"><meta property='og:url' content='https://chengxiaqiucao.github.io/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/'><meta property='og:site_name' content='秋 草 观 “测” 台'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='测试工具'><meta property='article:tag' content='自动化测试'><meta property='article:tag' content='Playwright'><meta property='article:published_time' content='2025-03-16T13:32:58+08:00'><meta property='article:modified_time' content='2025-03-16T13:32:58+08:00'><meta property='og:image' content='https://chengxiaqiucao.github.io/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo.png'><meta name=twitter:title content="Playwright新版本筛选功能"><meta name=twitter:description content="Playwright 最新的1.5.1版本中增加的一个实用更新介绍"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://chengxiaqiucao.github.io/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo.png'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/automnGrass_hu_5e44a092fd905642.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>秋 草 观 “测” 台</a></h1><h2 class=site-description>Testing is not just checking...</h2></div></header><ol class=menu-social><li><a href=https://github.com/chengxiaqiucao target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://space.bilibili.com/472272606 target=_blank title=Bilibili rel=me><!doctype html><svg t="1750732982440" class="icon" viewBox="0 0 1024 1024" p-id="4593" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M306.005333 117.632 444.330667 256h135.296l138.368-138.325333A42.666667 42.666667.0 01778.368 178.048L700.330667 256H789.333333A149.333333 149.333333.0 01938.666667 405.333333v341.333334A149.333333 149.333333.0 01789.333333 896H234.666667A149.333333 149.333333.0 0185.333333 746.666667V405.333333A149.333333 149.333333.0 01234.666667 256h88.96L245.632 177.962667a42.666667 42.666667.0 0160.373333-60.373334zm483.328 223.701333H234.666667a64 64 0 00-63.701334 57.856L170.666667 405.333333v341.333334a64 64 0 0057.856 63.701333L234.666667 810.666667h554.666666a64 64 0 0063.701334-57.856L853.333333 746.666667V405.333333a64 64 0 00-64-64zm-448 128A42.666667 42.666667.0 01384 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666666-42.666667zm341.333334.0A42.666667 42.666667.0 01725.333333 512v85.333333a42.666667 42.666667.0 01-85.333333.0V512a42.666667 42.666667.0 0142.666667-42.666667z" p-id="4594" fill="#8a8a8a"/></svg></a></li><li><a href=https://www.zhihu.com/people/qiucao target=_blank title=zhihu rel=me><!doctype html><svg t="1750733049138" class="icon" viewBox="0 0 1024 1024" p-id="5820" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M570.581333 806.272h61.952L652.928 876.117333 764.074667 806.272h130.986666V230.186667h-324.48V806.272zM636.501333 292.693333h192.64V743.68h-73.898666l-73.813334 46.378667L668.032 743.808l-31.530667-.128V292.736zM515.754667 493.738667H377.429333a2999.466667 2999.466667.0 005.802667-194.56h135.338667S523.776 239.445334 495.872 240.128H261.76c9.216-34.730667 20.821333-70.613333 34.688-107.690667.0.0-63.701333.0-85.333333 57.130667C202.112 213.12 176.128 303.786667 129.877333 396.416c15.573333-1.706667 67.114667-3.114667 97.450667-58.794667 5.589333-15.616 6.656-17.621333 13.568-38.485333h76.373333c0 27.776-3.157333 177.109333-4.437333 194.474667h-138.24c-31.104.0-41.173333 62.549333-41.173333 62.549333h173.482666C295.253333 688.256 232.789333 799.573333 119.466667 887.466667c54.186667 15.488 108.202667-2.432 134.912-26.197334.0.0 60.8-55.338667 94.122666-183.381333L491.264 849.834667s20.906667-71.168-3.285333-105.856c-20.053333-23.637333-74.24-87.552-97.322667-110.72l-38.698667 30.72c11.52-36.992 18.474667-72.96 20.821334-107.690667h163.072s-.213333-62.549333-20.053334-62.549333z" p-id="5821" fill="#8a8a8a"/></svg></a></li><li><a href=mailto:%20danmyw@qq.com target=_blank title=e-mail rel=me><!doctype html><svg t="1750733089669" class="icon" viewBox="0 0 1451 1024" p-id="6983" xmlns:xlink="http://www.w3.org/1999/xlink" width="283.3984375" height="200"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z" fill="#8a8a8a" p-id="6984"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>主页</span></a></li><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>检索</span></a></li><li><a href=/page/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li><a href=/page/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li><a href=/page/releases/><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg>
<span>热门开源</span></a></li><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://chengxiaqiucao.github.io/en/>English</option><option value=https://chengxiaqiucao.github.io/ selected>中文</option></select></li><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#前言>前言</a></li><li><a href=#playwright-最新版本提供了一个简化方法>Playwright 最新版本提供了一个简化方法</a></li><li><a href=#场景实战过滤可见商品>场景实战：过滤可见商品</a><ol><li><a href=#需求场景><strong>需求场景</strong></a></li></ol></li><li><a href=#新旧方案对比><strong>新旧方案对比</strong></a><ol><li><a href=#旧方法手动遍历可见性检查>旧方法：手动遍历+可见性检查</a></li><li><a href=#新方案一行代码过滤可见元素><strong>新方案：一行代码过滤可见元素</strong></a></li></ol></li><li><a href=#扩展应用电商测试中的常见场景><strong>扩展应用：电商测试中的常见场景</strong></a><ol><li><a href=#场景1验证悬浮显示的促销标签><strong>场景1：验证悬浮显示的促销标签</strong></a></li><li><a href=#场景2过滤弹窗干扰><strong>场景2：过滤弹窗干扰</strong></a></li></ol></li><li><a href=#结语>结语</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/><img src=/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo_hu_6d19694e6ec967d9.png srcset="/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo_hu_6d19694e6ec967d9.png 800w, /post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/playwright_logo_hu_6120bb7a3e4e18ca.png 1600w" width=800 height=483 loading=lazy alt="Featured image of post Playwright新版本筛选功能"></a></div><div class=article-details><header class=article-category><a href=/categories/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/ style=background-color:#c6fad2;color:#000>测试工具</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/066-playwright%E6%96%B0%E7%89%88%E6%9C%AC%E7%AD%9B%E9%80%89%E5%8A%9F%E8%83%BD/>Playwright新版本筛选功能</a></h2><h3 class=article-subtitle>Playwright 最新的1.5.1版本中增加的一个实用更新介绍</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 16, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 5 分钟</time></div></footer></div></header><section class=article-content><hr><h3 id=前言>前言</h3><p>在进行软件测试，比如针对一个电商网站，你是否遇到过这些问题？</p><ul><li><strong>动态加载的商品列表</strong>：部分商品因缺货、促销结束或未登录状态被隐藏。</li><li><strong>悬浮显示的促销标签</strong>：仅当用户鼠标悬停时才会展示优惠信息。</li><li><strong>广告弹窗干扰</strong>：某些弹窗可能遮挡核心功能，但测试时需要确保主流程不受影响。</li></ul><p>这些场景的共同点是：<strong>页面元素可能存在于DOM中，但用户实际不可见</strong>， 比如设置CSS属性（<code>display: none</code>、<code>visibility: hidden</code>）。传统测试方法需要手动判断元素可见性，遍历或预先这对具体对象进行分支判断，比较复杂。</p><hr><h3 id=playwright-最新版本提供了一个简化方法>Playwright 最新版本提供了一个简化方法</h3><p>在最新更新的 Playwright V1.5.1 版本更新中，针对<code>locator.filter()</code>方法新增了<code>visible</code>选项，可以极大简化这部分操作。（<em>目前针对node.js有此更新，Python语言尚未支持</em>）</p><p>其核心作用是：<br><strong>仅筛选页面上用户实际可见的元素</strong>，自动忽略因CSS（如<code>display: none</code>）或布局原因隐藏的元素。</p><p><strong>技术原理</strong>：<br>Playwright通过计算元素的布局边界、透明度、层叠上下文等属性，判断元素是否在视口内且对用户可见。这与真实用户视角完全一致，避免因操作隐藏元素导致测试失败。</p><hr><h3 id=场景实战过滤可见商品>场景实战：过滤可见商品</h3><p>假设我们测试一个中文电商平台的**“限时秒杀”页面**，其HTML结构如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>限时秒杀<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>div</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;seckill-list&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- 可见商品 --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data-testid</span><span class=o>=</span><span class=s>&#34;product-item&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>【爆款】无线蓝牙耳机<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;price&#34;</span><span class=p>&gt;</span>促销价: ¥199<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>立即抢购<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data-testid</span><span class=o>=</span><span class=s>&#34;product-item&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>智能手环<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;price&#34;</span><span class=p>&gt;</span>促销价: ¥299<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>立即抢购<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- 隐藏商品（已抢光或未开始） --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data-testid</span><span class=o>=</span><span class=s>&#34;product-item&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display: none;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>家用投影仪<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;price&#34;</span><span class=p>&gt;</span>促销价: ¥899<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>已售罄<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>div</span> <span class=na>data-testid</span><span class=o>=</span><span class=s>&#34;product-item&#34;</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product&#34;</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;opacity: 0;&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>空气炸锅<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&#34;price&#34;</span><span class=p>&gt;</span>促销价: ¥399<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>&lt;</span><span class=nt>button</span><span class=p>&gt;</span>未开始<span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=需求场景><strong>需求场景</strong></h4><p>用户访问“限时秒杀”页面时，<strong>仅展示可抢购的商品</strong>（前两项），隐藏已售罄或未开始的商品。我们需要验证：</p><ol><li>页面中用户可见的商品数量是否正确。</li><li>“立即抢购”按钮仅对可见商品生效。</li></ol><hr><h3 id=新旧方案对比><strong>新旧方案对比</strong></h3><h4 id=旧方法手动遍历可见性检查>旧方法：手动遍历+可见性检查</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// 旧方案示例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>test</span><span class=p>,</span> <span class=nx>expect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@playwright/test&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>test</span><span class=p>(</span><span class=s1>&#39;验证可见商品数量&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>page</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>page</span><span class=p>.</span><span class=kr>goto</span><span class=p>(</span><span class=s1>&#39;https://mall.example.com/seckill&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>allProducts</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>page</span><span class=p>.</span><span class=nx>getByTestId</span><span class=p>(</span><span class=s1>&#39;product-item&#39;</span><span class=p>).</span><span class=nx>all</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>visibleCount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>product</span> <span class=k>of</span> <span class=nx>allProducts</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=k>await</span> <span class=nx>product</span><span class=p>.</span><span class=nx>isVisible</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>visibleCount</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span><span class=p>(</span><span class=nx>visibleCount</span><span class=p>).</span><span class=nx>toBe</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span> <span class=c1>// 断言可见商品为2个
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>痛点</strong>：</p><ul><li>需要手动遍历所有元素，代码冗余。</li><li>若商品数量动态变化（如分页加载），维护成本高。</li></ul><h4 id=新方案一行代码过滤可见元素><strong>新方案：一行代码过滤可见元素</strong></h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// 新方案示例
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>import</span> <span class=p>{</span> <span class=nx>test</span><span class=p>,</span> <span class=nx>expect</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@playwright/test&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nx>test</span><span class=p>(</span><span class=s1>&#39;验证可见商品数量&#39;</span><span class=p>,</span> <span class=kr>async</span> <span class=p>({</span> <span class=nx>page</span> <span class=p>})</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>page</span><span class=p>.</span><span class=kr>goto</span><span class=p>(</span><span class=s1>&#39;https://mall.example.com/seckill&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>visibleProducts</span> <span class=o>=</span> <span class=nx>page</span><span class=p>.</span><span class=nx>getByTestId</span><span class=p>(</span><span class=s1>&#39;product-item&#39;</span><span class=p>).</span><span class=nx>filter</span><span class=p>({</span> <span class=nx>visible</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 断言可见商品数量为2
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=nx>expect</span><span class=p>(</span><span class=nx>visibleProducts</span><span class=p>).</span><span class=nx>toHaveCount</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 断言所有可见商品均可点击“立即抢购”
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>await</span> <span class=nx>expect</span><span class=p>(</span><span class=nx>visibleProducts</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;立即抢购&#39;</span><span class=p>)).</span><span class=nx>toHaveCount</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>优势</strong>：</p><ol><li><strong>代码简洁</strong>：无需循环，直接通过链式调用过滤。</li><li><strong>实时匹配</strong>：自动响应页面动态变化（如AJAX加载新商品）。</li><li><strong>精准断言</strong>：结合Playwright的软断言（Soft Assertions），可同时验证多个条件。</li></ol><hr><h3 id=扩展应用电商测试中的常见场景><strong>扩展应用：电商测试中的常见场景</strong></h3><h4 id=场景1验证悬浮显示的促销标签><strong>场景1：验证悬浮显示的促销标签</strong></h4><p>某些商品的“限时折扣”标签仅在鼠标悬停时显示。通过<code>visible: true</code>可确保仅操作实际可见的元素：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// 鼠标悬停后，验证促销标签可见
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>productCard</span> <span class=o>=</span> <span class=nx>page</span><span class=p>.</span><span class=nx>getByTestId</span><span class=p>(</span><span class=s1>&#39;product-card&#39;</span><span class=p>).</span><span class=nx>filter</span><span class=p>({</span> <span class=nx>visible</span>: <span class=kt>true</span> <span class=p>}).</span><span class=nx>first</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=nx>productCard</span><span class=p>.</span><span class=nx>hover</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>discountTag</span> <span class=o>=</span> <span class=nx>productCard</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;限时5折&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=nx>expect</span><span class=p>(</span><span class=nx>discountTag</span><span class=p>).</span><span class=nx>toBeVisible</span><span class=p>();</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=场景2过滤弹窗干扰><strong>场景2：过滤弹窗干扰</strong></h4><p>若页面存在广告弹窗，可通过<code>visible: true</code>跳过隐藏的弹窗元素：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=c1>// 关闭可见的弹窗（忽略已隐藏的）
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>activePopup</span> <span class=o>=</span> <span class=nx>page</span><span class=p>.</span><span class=nx>getByTestId</span><span class=p>(</span><span class=s1>&#39;popup&#39;</span><span class=p>).</span><span class=nx>filter</span><span class=p>({</span> <span class=nx>visible</span>: <span class=kt>true</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=k>await</span> <span class=nx>activePopup</span><span class=p>.</span><span class=nx>isVisible</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>await</span> <span class=nx>activePopup</span><span class=p>.</span><span class=nx>getByText</span><span class=p>(</span><span class=s1>&#39;关闭&#39;</span><span class=p>).</span><span class=nx>click</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h3 id=结语>结语</h3><p>通过这个 <code>Playwright</code> 更新的实用功能，可以较大简化我们在进行自动化测试时编写的复杂度，也可以看到，作为势头正劲的新一代web测试工具，Playwright的不断升级优化还是很贴合实际且社区活跃，值得重点关注！</p><p>秋草也推出了一个 基于Pytest+Playwright的自动化框架实战课程，有兴趣的同学可关注：</p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/>测试工具</a>
<a href=/tags/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95/>自动化测试</a>
<a href=/tags/playwright/>Playwright</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/050-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%A5%BD%E5%B8%AE%E6%89%8B_chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%BD%95%E5%88%B6%E5%99%A8/><div class=article-image><img src=/post/050-%E8%87%AA%E5%8A%A8%E5%8C%96%E5%A5%BD%E5%B8%AE%E6%89%8B_chrome%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%BD%95%E5%88%B6%E5%99%A8/Pasted-20250218.0dd60658485e8eafdb0468e39a43eacd_hu_88f92bd342ae392e.png width=250 height=150 loading=lazy alt="Featured image of post 自动化好帮手_chrome浏览器的录制器" data-hash="md5-DdYGWEhejq/bBGjjmkPqzQ=="></div><div class=article-details><h2 class=article-title>自动化好帮手_chrome浏览器的录制器</h2></div></a></article><article><a href=/post/090-bruno%E8%BF%9B%E9%98%B6/><div class=article-details><h2 class=article-title>可以抛弃postman啦, API测试工具Bruno实用教程(二)：进阶篇</h2></div></a></article><article><a href=/post/088-bruno%E5%9F%BA%E7%A1%80/><div class=article-details><h2 class=article-title>Postman最佳平替, API测试工具Bruno实用教程(一)：基础篇</h2></div></a></article><article class=has-image><a href=/post/086-browser-use%E7%9A%84%E4%BD%BF%E7%94%A8/><div class=article-image><img src=/post/086-browser-use%E7%9A%84%E4%BD%BF%E7%94%A8/snap_20250529-1.a95fdf02020c92dee3dda3696b0084a2_hu_f12c8b3c870fdab.png width=250 height=150 loading=lazy alt="Featured image of post AI智能驱动浏览器工具Browser Use详解" data-hash="md5-qV/fAgIMkt7j3aNpawCEog=="></div><div class=article-details><h2 class=article-title>AI智能驱动浏览器工具Browser Use详解</h2></div></a></article><article class=has-image><a href=/post/089-bruno%E4%BB%8B%E7%BB%8D/><div class=article-image><img src=/post/089-bruno%E4%BB%8B%E7%BB%8D/snap_20250420-2.08587706a670667ac3ab77a32fec6d23_hu_4b8a4bf9a236d971.png width=250 height=150 loading=lazy alt="Featured image of post github星标超3万！Postman最强平替Bruno你用了吗？" data-hash="md5-CFh3BqZwZnrDq3ejL+xtIw=="></div><div class=article-details><h2 class=article-title>github星标超3万！Postman最强平替Bruno你用了吗？</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 |by 城下秋草（公众号： 秋草说测试）</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>